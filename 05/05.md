# 初心者分科会 第5回


## やること
+ 復習
+ Scopeの話
+ Moduleについて
+ オブジェクト指向について
+ Classについて



## 復習


### 名前，オブジェクト，参照について

+ 名前とは，オブジェクトの参照が格納されているもの
+ 例えば，`a="Hello"`と実行すると，str型の"Hello"というデータを持つオブジェクトの参照が，名前aに格納される
![05_01](./img/05_01.png)
+ `a="Python"`のようにaに新しい文字列を代入すると，新しいオブジェクトが作られ，その参照がaに格納される
![05_02](./img/05_02.png)



## Scopeの話

以下は，cPython の実装での話をしている．

### 名前空間とは？

+ 名前空間とは，名前が所属している領域のこと
+ 普通は，関数によって区切られる
+ その領域では，名前とオブジェクトがディクショナリによって保持されている(そのディクショナリは，locals()で確認できる)
+ global領域の名前空間に属する名前は，globals()でも確認できる

例えば，
```python3
def a():
	# 関数a内部の名前空間
	l = 0
	s = 'apple'

	def b():
		# 関数a内部の名前空間
		m = 1
		t = 'banana'
		print('in function b:', locals())

	print('in function a:',locals())
	b()

# globalの名前空間
n = 2
u = 'cake'
a()
print('in global:', locals())

#=>in function a: {'b': <function a.<locals>.b at 0x104c29488>, 's': 'apple', 'l': 0}
#=>in function b: {'t': 'banana', 'm': 1}
#=>in global: {'__name__': '__main__', '__doc__': None, '__package__': None, '__loader__': <class '_frozen_importlib.BuiltinImporter'>, '__spec__': None, '__annotations__': {}, '__builtins__': <module 'builtins' (built-in)>, 'a': <function a at 0x10910eea0>, 'n': 2, 'u': 'cake'}
```
とすると，関数aの内部と，globalに2つの名前空間ができ，

+ 関数a内部では `{l: 0, s: 'apple', b: 関数オブジェクトb}`
+ 関数b内部では `{m: 1, t: 'banana'}`
+ globalには `{a: 関数オブジェクトa, n: 2, u: 'banana', など}`

というデータを含む


### Scopeとは？

+ Scopeとは，ある名前空間から(直接)アクセスすることができる名前空間の範囲のこと
+ 直接アクセスするとは`a.b`のように`.`を使って対象を指定せず，`b`のようにアクセスする方法のこと
+ Scopeは視野のようなものであり，ある場所に立ったとき，そこから見える名前空間はどこまでかということである
+ 基本的に，自分より外側の名前が，スコープに含まれる
+ スコープにはいくつかの種類がある


### 名前を検索するときの，名前空間の優先順位

+ 名前を評価すると，それに対応するオブジェクトを探すために，その名前を持つ名前空間の検索が始まる
+ 何も指定していなければ以下の順に名前が検索される
	1. local(自分の関数内)
	2. nonlocal(localでもglobalでもない中間領域)のうち，よりlocalに近い内側のものから先に検索される
	3. global(自分のModule)
	4. builtins(len(), print(), str()などが入っている)
		+ より正確には`__builtins__`の属性を検索しているみたい

`print(spam)`がある名前空間から見た，Scope

![05_03](./img/05_03.png)

+ `builtins` は `import builtins`を行うことで見ることができる
+ builtinsがglobalより後に検索されていることがわかる
```python3
import builtins
builtins.spam = "hello"

print(spam)
#=>hello

spam = "python"
print(spam)
#=>python
```

### Scopeの指定
+ 指定できるScopeの種類は3種類あり，それぞれが上で述べた階層に対応する
	+ local
	+ nonlocal
	+ global
+ Scopeを指定することで，そのScope内から名前を探すことができる

```python3
def scope_test():
    def do_local():
        spam = "local spam"

    def do_nonlocal():
        nonlocal spam
        spam = "nonlocal spam"

    def do_global():
        global spam
        spam = "global spam"

    spam = "test spam"
    do_local()
    print("After local assignment:", spam)
    do_nonlocal()
    print("After nonlocal assignment:", spam)
    do_global()
    print("After global assignment:", spam)

scope_test()
print("In global scope:", spam)

#=>After local assignment: test spam
#=>After nonlocal assignment: nonlocal spam
#=>After global assignment: nonlocal spam
#=>In global scope: global spam
```

### クロージャ

+ 関数は，定義されたときの周りの環境を保持している
+ 関数が定義されたときに，名前に対応するオブジェクトが見つかっていれば(=束縛されていれば)，呼び出し時の環境に同じ変数があっても影響を受けない
+ 束縛されているとき
```python3
def return_i():
	def a():
		return i
	i=0
	return a

f = return_i()

i=10

print(f())
#=>0
```

+ 束縛されていないとき
```python3
def return_i():
	def a():
		return i
	return a

f = return_i()

i=10

print(f())
#=>10
```




## Moduleについて

### Moduleとは？

便利な機能をまとめて，他のプログラムから利用できるようにしたファイルのこと

スクリプトモードで実行されたスクリプトや，インタプリタモードで書いたコマンドは，main Module に属する

```python3
# my_module.py

def func():
	pass

PI = 3.14
```

### Packageとは？

Moduleを機能ごとにディレクトリに分けて保存したもの

昔はディレクトリ内に`__init__.py`が必須だった．いつからか要らなくなったらしい

`__init__.py`で，Packageを読み込んだときの初期化処理を定義できる

```
- my-package
  |
  |- __init__.py
  |- sub_package1
  |  |- __init__.py
  |  |- module1.py
  |
  |- sub_package2
     |- __init__.py
     |- module2.py
     |- module3.py
```

### importとは？

Module や Module 内のオブジェクトを，global名前空間に束縛すること

例えば
```python3
import my_module

print(locals())
#=>{'__name__': '__main__', '__doc__': None, '__package__': None, '__loader__': <class '_frozen_importlib.BuiltinImporter'>, '__spec__': None, '__annotations__': {}, '__builtins__': <module 'builtins' (built-in)>, 'my_module': <module 'my_module' from '#####'>}
```
my_moduleがmain Module の my_moduleに束縛された

### Moduleをimportする方法

3種類ある

#### import A

A という名前に <Module object A> が束縛される


#### import A as B

B という名前に <Module object A> が束縛される


#### from A import B

B という名前に Module A の中の オブジェクトB が束縛される

`from A import *`とすると module A の中のオブジェクトがすべて import されるが，名前空間が汚れる(多くの名前が名前空間に登録される)ため，推奨されない


### 相対import

Package内で，近くの階層にある Module を読み込むときに相対参照のようなものが使える

```
- my-package
  |
  |- __init__.py
  |- sub_package1
  |  |- __init__.py
  |  |- module1.py
  |
  |- sub_package2
     |- __init__.py
     |- module2.py
     |- module3.py
```

という状態で，
+ module3.py から module2.py を import するなら `from . import module2.py`
+ module1.py から module2.py を import するなら `from ..sub_package2 import module2.py`

`.`が増えるごとにより上の階層に戻る


### Package を読み込むときの注意

上と同じ状況で，main から module1.pyを読み込みたいとき
```python3
import my_package

my_package.sub_package.module1.***
```
というようにはできない

正しくは
```python3
import my_package.sub_package.module1

my_package.sub_package.module1.***
```
または
```python3
from my_package.sub_package import module1

module1.***
```
とする


## オブジェクト指向について

### オブジェクト指向の目的

+ 再利用性

他の工業の分野では，再利用が盛んに行われている．例えば，回路のICや，車のパーツ(エンジン，タイヤなど)，PCのパーツ(メモリ，HDD，CPUなど)．しかし，プログラミングの分野では行われてこなかった．クラスを，再利用の単位(=部品，パーツ)にすることによって，再利用しやすくする．

再利用性を高めることにより，同じものを何度も使わなくていいため(車輪の再発明を防ぐ)，開発のスピードを高めることができる．また，しっかり整備されたものを使うことによって，バグや脆弱性を防ぐことができる．


+ 拡張性





### オブジェクト指向とは

オブジェクトを中心として，プログラミングしていく手法


### オブジェクトとは？

まず，クラスという型を作る．このクラスには，オブジェクトに適応できる Method(操作) とオブジェクトが持つデータである Attribute(データ) が定義される

```python3
class Car:
	d = ['North', 'East', 'South', 'West']
	def __init___(self, kind):
		self.kind = kind
		self.verosity = 0
		self.direction = 0

	def speed_up(self, dv):
		self.verosity += dv

	def speed_down(self, dv):
		self.verosity -= dv

	def turn_right(self):
		self.direction += 1
		self.direction %= 4

	def turn_left(self):
		self.direction -= 1
		self.direction %= 4

	def info(self):
		return "kind is {}\nverosity is {}km/h\ndirection is {}".format(self.kind, self.verosity, d[self.direction])
```

クラスとは，オブジェクトを作るための雛形のようなものであり，クラスから，そのクラスを方として持つオブジェクト(インスタンス)を作る
```python3
my_car = Car('Toyota')
print(my_car.info())

my_car.speed_up(10)
my_car.turn_right()
print(my_car.info())
```


## クラスについて

```python3
class Animal:
	pass

a = Animal()
print(a)
#=><__main__.Animal object at 0x102464cf8>
```